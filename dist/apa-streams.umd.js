(function(s,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(s=typeof globalThis<"u"?globalThis:s||self,o(s["@apajs/streams"]={}))})(this,function(s){"use strict";let o=null,f=new WeakMap;class l{constructor(n){this.cb=n,this._set=new Set}unhook(){this._set.forEach(n=>n.delete(this))}}let c=e=>{o=new l(e),o.cb();let n=o;return o=null,n},d=(e,n)=>{if(o===null)return;let t;f.has(e)?t=f.get(e).get(n):f.set(e,new Map([[n,t=new Set]])),o._set.add(t),t.add(o)},i=(e,n)=>{if(!f.get(e))return;f.get(e).get(n).forEach(({cb:r})=>r())},h=e=>{let n={object:()=>Object.fromEntries(Object.entries(e).map(([t,r])=>[t,typeof r=="object"||typeof r=="function"?p(r):r])),function:()=>{let t=p(1);return c(()=>t.val=e()),t}};return n[typeof e]?n[typeof e]():{val:e}},p=e=>{let n=h(e);return new Proxy(n,{get(t,r,u){return d(t,r),Reflect.get(t,r,u)},set(t,r,u,b){return t[r]!==u&&(Reflect.set(t,r,u,b),i(t,r)),!0}})};s.hook=c,s.stream=p,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
