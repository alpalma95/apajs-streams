(function(f,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(f=typeof globalThis<"u"?globalThis:f||self,s(f["@apajs/streams"]={}))})(this,function(f){"use strict";let s=null,p=new WeakMap,l=e=>{s=e,e(),s=null},c=(e,o)=>{if(s===null)return;let t=new Map,n=new Set;p.has(e)?(t=p.get(e),n=t.get(o)):(p.set(e,t),t=p.get(e),t.set(o,n),n=t.get(o)),n.add(s)},u=(e,o)=>{if(!p.get(e))return;p.get(e).get(o).forEach(r=>r())},d=e=>{let o=typeof e=="object"?Object.fromEntries(Object.entries(e).map(([t,n])=>[t,typeof n=="object"?d(n):n])):typeof e=="function"?{val:e()}:{val:e};return new Proxy(o,{get(t,n,r){return c(t,n),Reflect.get(t,n,r)},set(t,n,r,i){return Reflect.set(t,n,r,i),u(t,n),!0}})};f.derive=l,f.stream=d,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
