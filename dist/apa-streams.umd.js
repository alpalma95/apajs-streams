(function(f,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(f=typeof globalThis<"u"?globalThis:f||self,n(f["@apajs/streams"]={}))})(this,function(f){"use strict";let n=null,p=new WeakMap,l=e=>{n=e,e(),n=null},c=(e,o)=>{if(n===null)return;let t=new Map,s=new Set;p.has(e)?(t=p.get(e),s=t.get(o)):(p.set(e,t),t=p.get(e),t.set(o,s),s=t.get(o)),s.add(n)},u=(e,o)=>{if(!p.get(e))return;p.get(e).get(o).forEach(d=>d())},r=e=>{let o=typeof e=="object"?Object.fromEntries(Object.entries(e).map(([t,s])=>[t,typeof s=="object"?r(s):s])):typeof e=="function"?{val:e()}:{val:e};return new Proxy(o,{get(t,s,d){return c(t,s),Reflect.get(t,s,d)},set(t,s,d,i){return t[s]!==d&&(Reflect.set(t,s,d,i),u(t,s)),!0}})};f.derive=l,f.stream=r,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
