(function(f,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(f=typeof globalThis<"u"?globalThis:f||self,s(f["@apajs/streams"]={}))})(this,function(f){"use strict";let s=null,p=new WeakMap,l=t=>{s=t,t(),s=null},u=(t,r)=>{if(s===null)return;let e=new Map,n=new Set;p.has(t)?(e=p.get(t),n=e.get(r)):(p.set(t,e),e=p.get(t),e.set(r,n),n=e.get(r)),n.add(s)},c=(t,r)=>{if(!p.get(t))return;p.get(t).get(r).forEach(o=>o())},i=t=>{let r={object:()=>Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"?d(n):n])),function:()=>{let e=d(1);return l(()=>e.val=t()),e}};return r[typeof t]?r[typeof t]():{val:t}},d=t=>{let r=i(t);return new Proxy(r,{get(e,n,o){return u(e,n),Reflect.get(e,n,o)},set(e,n,o,a){return e[n]!==o&&(Reflect.set(e,n,o,a),c(e,n)),!0}})};f.derive=l,f.stream=d,Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});
