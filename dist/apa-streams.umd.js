(function(r,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(r=typeof globalThis<"u"?globalThis:r||self,s(r["@apajs/streams"]={}))})(this,function(r){"use strict";let s=null,f=new WeakMap,u=t=>{s=t,t(),s=null},d=(t,o)=>{if(s===null)return;let e=new Map,n=new Set;f.has(t)?(e=f.get(t),n=e.get(o)):(f.set(t,e),e=f.get(t),e.set(o,n),n=e.get(o)),n.add(s)},c=(t,o)=>{if(!f.get(t))return;f.get(t).get(o).forEach(p=>p())},i=t=>{let o={object:()=>Object.fromEntries(Object.entries(t).map(([e,n])=>[e,typeof n=="object"||typeof n=="function"?l(n):n])),function:()=>{let e=l(1);return u(()=>e.val=t()),e}};return o[typeof t]?o[typeof t]():{val:t}},l=t=>{let o=i(t);return new Proxy(o,{get(e,n,p){return d(e,n),Reflect.get(e,n,p)},set(e,n,p,y){return e[n]!==p&&(Reflect.set(e,n,p,y),c(e,n)),!0}})};r.hook=u,r.stream=l,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
