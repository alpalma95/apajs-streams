let e=null,t=new WeakMap;class r{constructor(e){this.cb=e,this._set=new Set}unhook(){this._set.forEach((e=>e.delete(this)))}}let n=t=>{e=new r(t),e.cb();let n=e;return e=null,n},s=(r,n)=>{if(null===e)return;let s=((e,t,r)=>{let n;return e.has(t)&&e.get(t).has(r)?n=e.get(t).get(r):e.has(t)&&!e.get(t).has(r)?e.get(t).set(r,n=new Set):e.set(t,new Map([[r,n=new Set]])),n})(t,r,n);e._set.add(s),s.add(e)},o=e=>{let r=(e=>{if(Array.isArray(e)||"function"!=typeof e&&"object"!=typeof e)return{val:e};if("function"==typeof e){let t=o(1);return n((()=>t.val=e())),t}return Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"object"==typeof t||"function"==typeof t?o(t):t])))})(e);return new Proxy(r,{get:(e,t,r)=>(s(e,t),Reflect.get(e,t,r)),set:(e,r,n,s)=>(e[r]!==n&&(Reflect.set(e,r,n,s),((e,r)=>{t.get(e)&&t.get(e).get(r).forEach((({cb:e})=>e()))})(e,r)),!0)})};export{n as hook,o as stream};
//# sourceMappingURL=streams.min.js.map