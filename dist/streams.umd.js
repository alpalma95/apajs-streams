(function(r,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(r=typeof globalThis<"u"?globalThis:r||self,o(r["@reactiv/streams"]={}))})(this,function(r){"use strict";let o=null,c=new WeakMap;class d{constructor(t){this.cb=t,this._set=new Set}unhook(){this._set.forEach(t=>t.delete(this))}}const h=(e,t,s)=>{let n;return e.has(t)&&e.get(t).has(s)?n=e.get(t).get(s):e.has(t)&&!e.get(t).has(s)?e.get(t).set(s,n=new Set):e.set(t,new Map([[s,n=new Set]])),n};let u=e=>{o=new d(e),o.cb();let t=o;return o=null,t},i=(e,t)=>{if(o===null)return;let s=h(c,e,t);o._set.add(s),s.add(o)},l=(e,t)=>{if(!c.get(e))return;c.get(e).get(t).forEach(({cb:n})=>n())},y=e=>{if(Array.isArray(e)||typeof e!="function"&&typeof e!="object")return{val:e};if(typeof e=="function"){let t=p(1);return u(()=>t.val=e()),t}else return Object.fromEntries(Object.entries(e).map(([t,s])=>[t,typeof s=="object"||typeof s=="function"?p(s):s]))},p=e=>{let t=y(e);return new Proxy(t,{get(s,n,f){return i(s,n),Reflect.get(s,n,f)},set(s,n,f,b){return s[n]!==f&&(Reflect.set(s,n,f,b),l(s,n)),!0}})};r.hook=u,r.stream=p,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
